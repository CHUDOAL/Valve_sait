<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - Valve Corporation</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <span class="logo">üü†</span>
                <span class="brand-name">Valve</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/profile" class="nav-link active">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                <a href="/chat" class="nav-link">–ß–∞—Ç</a>
                <a href="/games" class="nav-link">–ò–≥—Ä—ã</a>
                <a href="#" onclick="logout()" class="nav-link">–í—ã—Ö–æ–¥</a>
            </div>
        </div>
    </nav>

    <main class="profile-main">
        <div class="container">
            <div class="profile-layout">
                <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
                <div class="profile-section">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                {% if user.avatar %}
                                <img id="avatar-img" src="{{ user.avatar }}" alt="Avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="avatar-placeholder" id="avatar-placeholder" style="display: none;">{{ user.username[0].upper() }}</div>
                                {% else %}
                                <div class="avatar-placeholder" id="avatar-placeholder">{{ user.username[0].upper() }}</div>
                                {% endif %}
                                <button class="btn-avatar-edit" onclick="editAvatar()">‚úèÔ∏è</button>
                            </div>
                            <div class="profile-info">
                                <h1 id="profile-username">{{ user.username }}</h1>
                                <p class="profile-email">{{ user.email }}</p>
                                <span class="badge badge-role badge-{{ user.role }}">{{ '–ù–∞—á–∞–ª—å–Ω–∏–∫' if user.role == 'boss' else '–ü–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–π' }}</span>
                            </div>
                        </div>
                        <div class="profile-description">
                            <h3>–û —Å–µ–±–µ</h3>
                            <p id="profile-description">{{ user.description or '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}</p>
                            <button class="btn btn-secondary btn-sm" onclick="editDescription()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary" onclick="showEditForm()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                        </div>
                    </div>

                    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div id="edit-form" class="edit-form" style="display: none;">
                        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                        <form onsubmit="handleProfileUpdate(event)">
                            <div class="form-group">
                                <label for="edit-username">–ù–∏–∫–Ω–µ–π–º</label>
                                <input type="text" id="edit-username" value="{{ user.username }}" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-avatar-file">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</label>
                                <input type="file" id="edit-avatar-file" accept="image/*" onchange="handleAvatarUpload(event)">
                                <small class="form-hint">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea id="edit-description" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ">{{ user.description or '' }}</textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button type="button" class="btn btn-secondary" onclick="hideEditForm()">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –ó–∞–¥–∞—á–∏ -->
                <div class="tasks-section">
                    <div class="tasks-header">
                        <h2>{% if user.role == 'boss' %}–ú–æ–∏ –∑–∞–¥–∞—á–∏{% else %}–ú–æ–∏ –∑–∞–¥–∞—á–∏{% endif %}</h2>
                        {% if user.role == 'boss' %}
                        <button class="btn btn-primary" onclick="showTaskForm()">+ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
                        {% endif %}
                    </div>

                    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞) -->
                    {% if user.role == 'boss' %}
                    <div id="task-form" class="task-form" style="display: none;">
                        <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
                        <form onsubmit="handleTaskCreate(event)">
                            <div class="form-group">
                                <label for="task-title">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input type="text" id="task-title" required>
                            </div>
                            <div class="form-group">
                                <label for="task-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea id="task-description" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="task-assigned">–ù–∞–∑–Ω–∞—á–∏—Ç—å</label>
                                <select id="task-assigned" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω–æ–≥–æ</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                                <button type="button" class="btn btn-secondary" onclick="hideTaskForm()">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </form>
                    </div>
                    {% endif %}

                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
                    <div id="tasks-list" class="tasks-list">
                        {% if tasks %}
                            {% for task in tasks %}
                            <div class="task-card" data-task-id="{{ task.id }}">
                                <div class="task-header">
                                    <h3>{{ task.title }}</h3>
                                    <span class="badge badge-status badge-{{ task.status }}">{{ task.status }}</span>
                                </div>
                                <p class="task-description">{{ task.description }}</p>
                                <div class="task-meta">
                                    {% if user.role == 'boss' %}
                                    <p>–ù–∞–∑–Ω–∞—á–µ–Ω–æ: <strong id="assigned-name-{{ task.id }}">–ó–∞–≥—Ä—É–∑–∫–∞...</strong></p>
                                    {% else %}
                                    <p>–û—Ç: <strong id="creator-name-{{ task.id }}">–ó–∞–≥—Ä—É–∑–∫–∞...</strong></p>
                                    {% endif %}
                                    <p>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                                </div>
                                {% if user.role == 'employee' %}
                                <div class="task-actions">
                                    <select class="status-select" onchange="updateTaskStatus({{ task.id }}, this.value)">
                                        <option value="pending" {% if task.status == 'pending' %}selected{% endif %}>–í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                                        <option value="in_progress" {% if task.status == 'in_progress' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
                                        <option value="completed" {% if task.status == 'completed' %}selected{% endif %}>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                                    </select>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <p>–ù–µ—Ç –∑–∞–¥–∞—á</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const currentUser = {{ user | tojson }};
        const userRole = '{{ user.role }}';
    </script>
    <script src="/static/script.js"></script>
</body>
</html>

